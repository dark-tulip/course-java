## Zookeeper - это первое хранилище метаданных (leaders, partitions)
- используется для упраления брокерами кафки, точнее хранит их список
- zookeeper used to manage kafka brokers
- helps to perform leader elections
- отправляет уведомления кафке об изменениях в конфигурации
- зукипер работает с нечетным числом серверов (1, 3, 5, 7)
- kafka 2.* cannot work without zookeeper (goes together)
- зукипер существует с момента появления кафки
- kafka 3.* may have kafka Raft instead of zookeeper (KIP-500)
- до кафки 4.0 желательно всегда использовать зукипер
- ЗУКИПЕР НИКОГДА НЕ хранит consumer offsets (ложная инфа в интернете)
- zeekeeper leader server (write), others, followers (for read)

### Зачем и когда нужен зукипер?
- когда работают внутренне с брокерами кафки
- не нужен клиентам кафки (по соображениям безопасности)
- весь API и CLI для работы с клиентами кафки уже мигрировал с зукипера в брокеры кафки
- порты зукпера должны быть открыты только кафка брокерам, НЕ кафка клиентам
- НИКОГДА не используйте зукипер в качестве конфигов для кафка клиентов, и других программ, которые connected с кафкой

### KRAFT - Raft протокол пришедший на замену зукиперу
- зукипер страдает по производительности когда кластер кафки имеет более 100_000 партиций
- единая модель безопасности
- слияние с кафкой изнутри
- быстрее время отклика, recovery и shutdown time (planned and unplanned)
- production ready since 3.3.1+
- kafka 4.+ больше не поддерживает зукипер
- проект KIP-500 проект по удалению зукипера из кафки
- to deploy more partitions per cluster

Выборы лидера zK основаны на протоколе, похожем на Paxos, который называется ZAB . Каждая запись проходит через лидера, а лидер генерирует идентификатор транзакции (zxid) и присваивает его каждому запросу на запись. Идентификатор представляет порядок, в котором записи применяются ко всем репликам. Запись считается успешной, если лидер получает подтверждение от большинства. Пояснение к ЗАБ .
